{"_path":"/os/dietpi/drivesleep","_dir":"dietpi","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Disk Sleep","description":"This seems to only be an issue with the RPI3 when using a USB Hard disk.\nWith the RPI4 it uses a different USB Controller and uses UAS instead which provides better performance and doesn't have the same problems.\nSo for a RPI4 you can ignore this.","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"disk-sleep"},"children":[{"type":"text","value":"Disk Sleep"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This seems to only be an issue with the RPI3 when using a USB Hard disk."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWith the RPI4 it uses a different USB Controller and uses UAS instead which provides better performance and doesn't have the same problems."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSo for a RPI4 you can ignore this."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I did notice with the RPI3 it would continually sleep the drive almost straight away."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWith the RPI4 this doesn't seem to be an issue since it uses UAS, however this does mean we can't use smartmon tools with the RPI4 to check the disk SMART status."}]},{"type":"element","tag":"h2","props":{"id":"rpi3-disk-sleep"},"children":[{"type":"text","value":"RPI3 Disk Sleep"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With a USB Drive attached, sometimes it will go into sleep continuously."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThere's a couple of ways to work around this."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"First install some tools."}]},{"type":"element","tag":"code","props":{"code":"apt install hdparm smartmontools\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"hdparm"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"smartmontools"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The first approach is to try disabling the spinddown using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"dietpi-drive_manager"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAnother approach is to use hdparm to disable advanced power management"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nthis seems to be necessary in some cases as some drives ignore the timeout."}]},{"type":"element","tag":"code","props":{"code":"# Get drive info\nsmartctl -i /dev/sda\n# Check drive health\nsmartctl -H /dev/sda\n\n# To check drive sleep status without waking it up\nsmartctl -i -n standby /dev/sda\n\n# To check the advanced power management value (default is 127)\nhdparm -B /dev/sda\n# To disable advanced power management\nhdparm -B 255 /dev/sda\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"# Get drive info\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"smartctl"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-i"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"# Check drive health\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"smartctl"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-H"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"# To check drive sleep status without waking it up\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"smartctl"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-i"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-n"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"standby"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"# To check the advanced power management value (default is 127)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"hdparm"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-B"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"# To disable advanced power management\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"hdparm"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-B"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"255"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"run-on-boot"},"children":[{"type":"text","value":"Run on Boot"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To set this to run on boot up (as it reset between reboots)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Create the file "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/var/lib/dietpi/postboot.d/hd.nosleep.sh"}]}]},{"type":"element","tag":"code","props":{"code":"#!/bin/sh\nhdparm -B 255 /dev/sda\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-9425a5"},"children":[{"type":"text","value":"#!/bin/sh\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"hdparm"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"-B"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96378f"},"children":[{"type":"text","value":"255"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/dev/sda"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Make sure the file is executable"}]},{"type":"element","tag":"code","props":{"code":"chmod +x /var/lib/dietpi/postboot.d/hd.nosleep.sh\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-3d7890"},"children":[{"type":"text","value":"chmod"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"+x"}]},{"type":"element","tag":"span","props":{"class":"ct-fe41a2"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-aee1ba"},"children":[{"type":"text","value":"/var/lib/dietpi/postboot.d/hd.nosleep.sh"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-96378f{color:#0550AE}\n.ct-9425a5{color:#6E7781}\n.ct-aee1ba{color:#0A3069}\n.ct-fe41a2{color:#24292F}\n.ct-3d7890{color:#953800}\n.dark .ct-3d7890{color:#FFA657}\n.dark .ct-fe41a2{color:#C9D1D9}\n.dark .ct-aee1ba{color:#A5D6FF}\n.dark .ct-9425a5{color:#8B949E}\n.dark .ct-96378f{color:#79C0FF}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"rpi3-disk-sleep","depth":2,"text":"RPI3 Disk Sleep","children":[{"id":"run-on-boot","depth":3,"text":"Run on Boot"}]}]}},"_type":"markdown","_id":"content:1.os:1.dietpi:3.drivesleep.md","_source":"content","_file":"1.os/1.dietpi/3.drivesleep.md","_extension":"md"}