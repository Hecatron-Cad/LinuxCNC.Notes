{"_path":"/os/kernel/rpi-kernel","_dir":"kernel","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"RPi Kernel","description":"Details on building a realtime kernel for the Rpi.\nlinuxcnc seems to recommend the Rpi4 as a minimum","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"rpi-kernel"},"children":[{"type":"text","value":"RPi Kernel"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Details on building a realtime kernel for the Rpi."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nlinuxcnc seems to recommend the Rpi4 as a minimum"}]},{"type":"element","tag":"h2","props":{"id":"downloading-sources"},"children":[{"type":"text","value":"Downloading Sources"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/raspberrypi/linux","rel":["nofollow"]},"children":[{"type":"text","value":"https://github.com/raspberrypi/linux"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.raspberrypi.com/documentation/computers/linux_kernel.html","rel":["nofollow"]},"children":[{"type":"text","value":"https://www.raspberrypi.com/documentation/computers/linux_kernel.html"}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Install some dependencies"}]},{"type":"element","tag":"code","props":{"code":"sudo apt install git bc bison flex libssl-dev make gcc raspberrypi-kernel-headers libc6-dev\nsudo apt install patch xz-utils libncurses-dev\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"git"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"bc"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"bison"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"flex"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"libssl-dev"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"gcc"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"raspberrypi-kernel-headers"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"libc6-dev\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"sudo"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"patch"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"xz-utils"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"libncurses-dev"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To download the sources without the full git repository (as this can take a long time)"}]},{"type":"element","tag":"code","props":{"code":"# Using kernel 6.3 as an example here\ncd /usr/src\n# For the latest master\nwget https://github.com/raspberrypi/linux/archive/refs/heads/rpi-6.3.y.tar.gz\n# For a specific version based on the commit hash (what I'm current;y using)\nwget https://github.com/raspberrypi/linux/archive/2d0a7ff52ebfe7bc1c08fd7e444b9ce3d34385bf.tar.gz -O rpi-6.3.y.tar.gz\n\n# Extract the files\ntar -xvf rpi-6.3.y.tar.gz\nmv linux-rpi-6.3.y linux-6.3.2-rt\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Using kernel 6.3 as an example here\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/usr/src\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# For the latest master\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"wget"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"https://github.com/raspberrypi/linux/archive/refs/heads/rpi-6.3.y.tar.gz\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# For a specific version based on the commit hash (what I'm current;y using)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"wget"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"https://github.com/raspberrypi/linux/archive/2d0a7ff52ebfe7bc1c08fd7e444b9ce3d34385bf.tar.gz"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-O"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"rpi-6.3.y.tar.gz\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Extract the files\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"tar"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-xvf"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"rpi-6.3.y.tar.gz\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"mv"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"linux-rpi-6.3.y"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"linux-6.3.2-rt"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"patch-sources"},"children":[{"type":"text","value":"Patch Sources"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To determine which version the sources are using"}]},{"type":"element","tag":"code","props":{"code":"head linux-6.3.2-rt/Makefile -n 4\n# Given I've specified the git hash above for a specific version, this should be 6.3.2\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"head"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"linux-6.3.2-rt/Makefile"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-n"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"4\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Given I've specified the git hash above for a specific version, this should be 6.3.2"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Download and apply the patch file for the relevant kernel version."}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/","rel":["nofollow"]},"children":[{"type":"text","value":"https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/"}]}]}]},{"type":"element","tag":"code","props":{"code":"cd /usr/src/\nwget https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/6.3/patch-6.3.3-rt15.patch.xz\ncd linux-6.3.2-rt\nxzcat ../patch-6.3.3-rt15.patch.xz | patch -p1\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/usr/src/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"wget"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"https://mirrors.edge.kernel.org/pub/linux/kernel/projects/rt/"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/patch-6.3.3-rt15.patch.xz\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"cd"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"linux-6.3.2-rt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"xzcat"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"../patch-6.3.3-rt15.patch.xz"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5c108d"},"children":[{"type":"text","value":"|"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"patch"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-p1"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Note for this specific patch, it may complain while trying to apply the last hunk."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThis is due to it already being applied in the kernel sources, so just answer the prompt with 'n'"}]},{"type":"element","tag":"h2","props":{"id":"configure-sources"},"children":[{"type":"text","value":"Configure Sources"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next create a default configuration for the RPI4"}]},{"type":"element","tag":"code","props":{"code":"# 64bit Rpi4 / Rpi3\nmake bcm2711_defconfig\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# 64bit Rpi4 / Rpi3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"bcm2711_defconfig"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next let's make some configuration changes."}]},{"type":"element","tag":"code","props":{"code":"make menuconfig\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"menuconfig"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The main ones to change are:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"General -> Preemption Model"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nswitch this to "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Full Real-time"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"General Setup -> Local Version\nadd something to the end of "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"CONFIG_LOCALVERSION"}]},{"type":"text","value":" to make it unique."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSuch as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-rt-linuxcnc1"}]}]}]},{"type":"element","tag":"h2","props":{"id":"build-install-kernel"},"children":[{"type":"text","value":"Build / Install kernel"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we're going to build the kernel sources."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nSomething to remember at this point is if you've already added "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"isolcpus=2,3"}]},{"type":"text","value":" to the /boot/cmdline.txt file."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThen it's going to take twice as long to compile due to two of the core's being unavailable for general use."}]},{"type":"element","tag":"code","props":{"code":"# Build the kernel - 64bit\nmake -j4 Image.gz modules dtbs\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Build the kernel - 64bit\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-j4"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"Image.gz"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"modules"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"dtbs"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we're going to install the kernel modules"}]},{"type":"element","tag":"code","props":{"code":"# This typically copies the modules across to a directory such as /lib/modules/6.3.2-rt13-v8-rt-linuxcnc1\nmake modules_install\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# This typically copies the modules across to a directory such as /lib/modules/6.3.2-rt13-v8-rt-linuxcnc1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"make"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"modules_install"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, we're going to install the kernel image and other boot related files.\nThe best way to do this is to use a separate directory so that we don't overwrite the default kernel."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWe can then just switch back and forth between the default and the realtime kernel using a single config line under "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot/config.txt"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In this example we're using the directory "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot/rt-6.3/"}]}]},{"type":"element","tag":"code","props":{"code":"# Install the kernel image and boot files - 64bit\nmkdir -p /boot/rt-6.3/overlays/\ncp arch/arm64/boot/dts/broadcom/*.dtb /boot/rt-6.3/\ncp arch/arm64/boot/dts/overlays/*.dtb* /boot/rt-6.3/overlays/\ncp arch/arm64/boot/dts/overlays/README /boot/rt-6.3/overlays/\ncp arch/arm64/boot/Image.gz /boot/rt-6.3/kernel8.img\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Install the kernel image and boot files - 64bit\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"mkdir"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"-p"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/boot/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/overlays/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"arch/arm64/boot/dts/broadcom/"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":".dtb"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/boot/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"arch/arm64/boot/dts/overlays/"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":".dtb"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/boot/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/overlays/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"arch/arm64/boot/dts/overlays/README"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/boot/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/overlays/\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"cp"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"arch/arm64/boot/Image.gz"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/boot/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/kernel8.img"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"boot-config"},"children":[{"type":"text","value":"Boot Config"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next edit the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot/config.txt"}]},{"type":"text","value":" file."}]},{"type":"element","tag":"code","props":{"code":"# Add this to the top of the file\nos_prefix=/rt-6.3/\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-7bb9b4"},"children":[{"type":"text","value":"# Add this to the top of the file\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":"os_prefix"}]},{"type":"element","tag":"span","props":{"class":"ct-5c108d"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/rt-"}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"6.3"}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"This should select the realtime kernel we're ve just installed into the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/boot/rt-6.3"}]},{"type":"text","value":" directory on the next reboot."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIf you need to switch back to the default kernel, just comment out the line and reboot."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nTo reboot the machine "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"/sbin/reboot"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nAfter a reboot, we can check the kernel version with "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"uname -a"}]},{"type":"text","value":" to make sure it has RT in it's name"}]},{"type":"element","tag":"h2","props":{"id":"_32bit-64bit-kernel"},"children":[{"type":"text","value":"32bit / 64bit kernel"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For the RPI4 we have "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"kernel8.img"}]},{"type":"text","value":" for 64 bit and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"kernel7l.img"}]},{"type":"text","value":" for 32bit."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIt's determined which one to use within config.txt via the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"arm_64bit"}]},{"type":"text","value":" setting."},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nThis currently defaults to 1 now for 64bit, unless specifically set to 0 for 32bit."}]},{"type":"element","tag":"code","props":{"code":"arm_64bit=1\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":"arm_64bit"}]},{"type":"element","tag":"span","props":{"class":"ct-5c108d"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-96f36a"},"children":[{"type":"text","value":"1"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"reading-the-live-kernel-configuration"},"children":[{"type":"text","value":"Reading The Live Kernel Configuration"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If you want to read the config from the running kernel"},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\n(what was used to compile the kernel)"}]},{"type":"element","tag":"code","props":{"code":"modprobe configs\nzcat /proc/config.gz > ./output\n","language":"sh","meta":null},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"modprobe"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"configs\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-a6d474"},"children":[{"type":"text","value":"zcat"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"/proc/config.gz"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-5c108d"},"children":[{"type":"text","value":">"}]},{"type":"element","tag":"span","props":{"class":"ct-90e474"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-dc185b"},"children":[{"type":"text","value":"./output"}]}]}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-5c108d{color:#CF222E}\n.ct-96f36a{color:#0550AE}\n.ct-7bb9b4{color:#6E7781}\n.ct-dc185b{color:#0A3069}\n.ct-90e474{color:#24292F}\n.ct-a6d474{color:#953800}\n.dark .ct-a6d474{color:#FFA657}\n.dark .ct-90e474{color:#C9D1D9}\n.dark .ct-dc185b{color:#A5D6FF}\n.dark .ct-7bb9b4{color:#8B949E}\n.dark .ct-96f36a{color:#79C0FF}\n.dark .ct-5c108d{color:#FF7B72}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"downloading-sources","depth":2,"text":"Downloading Sources"},{"id":"patch-sources","depth":2,"text":"Patch Sources"},{"id":"configure-sources","depth":2,"text":"Configure Sources"},{"id":"build-install-kernel","depth":2,"text":"Build / Install kernel"},{"id":"boot-config","depth":2,"text":"Boot Config"},{"id":"_32bit-64bit-kernel","depth":2,"text":"32bit / 64bit kernel"},{"id":"reading-the-live-kernel-configuration","depth":2,"text":"Reading The Live Kernel Configuration"}]}},"_type":"markdown","_id":"content:1.os:3.kernel:1.rpi-kernel.md","_source":"content","_file":"1.os/3.kernel/1.rpi-kernel.md","_extension":"md"}